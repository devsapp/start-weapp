## ğŸš€ ä¸€é”®éƒ¨ç½²
æ‚¨å¯ä»¥ç‚¹å‡» ç‚¹å‡»`ä¸€é”®éƒ¨ç½²`æŒ‰é’®,è¿›è¡Œå¿«é€Ÿä½“éªŒ

[![Deploy with Severless Devs](https://img.alicdn.com/imgextra/i1/O1CN01w5RFbX1v45s8TIXPz_!!6000000006118-55-tps-95-28.svg)](https://fcnext.console.aliyun.com/applications/create?template=start-weapp)
# å¾®ä¿¡å°ç¨‹åºæ¡ˆä¾‹

> å¿«é€Ÿéƒ¨ç½²å’Œä½“éªŒ Serverless æ¶æ„ä¸‹çš„ Typescript + hapi + Taro + React çš„å¾®ä¿¡å°ç¨‹åºé¡¹ç›®ã€‚

- [å¾®ä¿¡å°ç¨‹åºæ¡ˆä¾‹](#å¾®ä¿¡å°ç¨‹åºæ¡ˆä¾‹)
  - [æºä»£ç ](#æºä»£ç )
  - [æ•ˆæœé¢„è§ˆ](#æ•ˆæœé¢„è§ˆ)
  - [æ•´ä½“ä½“éªŒæµç¨‹](#æ•´ä½“ä½“éªŒæµç¨‹)
  - [å¦‚ä½•å¼€å‘ï¼Ÿ](#å¦‚ä½•å¼€å‘)
    - [å°ç¨‹åºå®¢æˆ·ç«¯](#å°ç¨‹åºå®¢æˆ·ç«¯)
    - [å‡†å¤‡](#å‡†å¤‡)
    - [æ›¿æ¢ `s.yaml` ä¸­çš„å˜é‡](#æ›¿æ¢-syaml-ä¸­çš„å˜é‡)
    - [æœ¬åœ°å¼€å‘](#æœ¬åœ°å¼€å‘)
    - [é€šè¿‡äº‘ä¸Šåº”ç”¨ä¸­å¿ƒéƒ¨ç½²](#é€šè¿‡äº‘ä¸Šåº”ç”¨ä¸­å¿ƒéƒ¨ç½²)
    - [é€šè¿‡æœ¬åœ°ç¯å¢ƒéƒ¨ç½²](#é€šè¿‡æœ¬åœ°ç¯å¢ƒéƒ¨ç½²)
    - [é€šè¿‡æœ¬åœ°ç¯å¢ƒéƒ¨ç½²ï¼ˆä¸åŒ…æ‹¬ node_modulesï¼‰](#é€šè¿‡æœ¬åœ°ç¯å¢ƒéƒ¨ç½²ä¸åŒ…æ‹¬-node_modules)
    - [åˆ›å»ºå¹¶å‘å¸ƒå±‚](#åˆ›å»ºå¹¶å‘å¸ƒå±‚)
## æºä»£ç 

- [:octocat: æœåŠ¡ç«¯æºä»£ç ](https://github.com/devsapp/start-weapp/tree/main/src)
- [:octocat: å®¢æˆ·ç«¯æºä»£ç ](https://github.com/devsapp/weapp-client)
  
## æ•ˆæœé¢„è§ˆ

å¯ä»¥åœ¨æ‰‹æœºé‡Œä½¿ç”¨ä½ çš„å°ç¨‹åº

![try](https://img.alicdn.com/imgextra/i4/O1CN01anewVJ1gAlPEkkA1U_!!6000000004102-0-tps-258-258.jpg)

![view](https://img.alicdn.com/imgextra/i3/O1CN01tcjzXg1UKaVsUjhTw_!!6000000002499-0-tps-404-528.jpg)

## æ•´ä½“ä½“éªŒæµç¨‹

1. åœ¨[é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—](https://fcnext.console.aliyun.com/)æ§åˆ¶å°çš„â€œåº”ç”¨ä¸­å¿ƒâ€ä¸­ä¸€é”®éƒ¨ç½²å½“å‰å°ç¨‹åºåç«¯ã€‚
2. åœ¨[å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/)ä¸Šæ³¨å†Œå¾®ä¿¡å°ç¨‹åºã€‚
3. `git clone git@github.com:devsapp/weapp-client.git` ä¸‹è½½å½“å‰ç¤ºä¾‹çš„å°ç¨‹åºå®¢æˆ·ç«¯ä»£ç ã€‚å¹¶æŒ‰ç…§[è¯´æ˜](https://github.com/devsapp/weapp-client/blob/main/README.md)æ„å»ºï¼Œå¹¶å‘å¸ƒå°ç¨‹åºå®¢æˆ·ç«¯ã€‚
4. åœ¨[å¾®ä¿¡å…¬ä¼—å¹³å° -> å¼€å‘ç®¡ç† -> å¼€å‘è®¾ç½®](https://mp.weixin.qq.com/)é¡µé¢è·å–å°ç¨‹åºçš„ AppID å’Œ AppSecretï¼Œç„¶ååœ¨å‡½æ•°è®¡ç®—æ§åˆ¶å°ç»™å‡½æ•°é…ç½®åç§°ä¸º `APP_ID` å’Œ `SECRET` çš„ç¯å¢ƒå˜é‡ã€‚
5. åœ¨[å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/)æ‰¾åˆ°æµ‹è¯•äºŒç»´ç ï¼Œç„¶åé€šè¿‡æ‰‹æœºè¿›è¡Œæµ‹è¯•ã€‚æ‚¨ä¹Ÿå¯ä»¥æ·»åŠ æ›´å¤šä½“éªŒæˆå‘˜ï¼Œä½¿ç”¨æ‚¨çš„å°ç¨‹åºã€‚
## å¦‚ä½•å¼€å‘ï¼Ÿ
### å°ç¨‹åºå®¢æˆ·ç«¯

å®¢æˆ·ç«¯ä»£ç åœ°å€ä¸º https://github.com/devsapp/weapp-client
è¯·æŒ‰ç…§å®¢æˆ·ç«¯ä¸­çš„è¯´æ˜é…ç½®å¹¶å‘å¸ƒå°ç¨‹åºå®¢æˆ·ç«¯ã€‚

åœ¨æœ¬é¡¹ç›®çš„è®¤è¯æ¨¡å—`auth/index.ts`ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†å¾®ä¿¡ç”¨æˆ·çš„ç™»å½•ï¼Œæ‚¨å¯ä»¥è·å–åˆ°å¾®ä¿¡ç”¨æˆ·çš„å”¯ä¸€ idã€‚æ‚¨ç”³è¯·å®Œå°ç¨‹åºåï¼Œéœ€è¦æ‰¾åˆ°åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°ä¸Šï¼ˆå¼€å‘ç®¡ç† -> å¼€å‘è®¾ç½®é¡µé¢ï¼‰è·å–å°ç¨‹åºçš„ AppID å’Œ AppSecret ï¼Œç„¶ååœ¨æ§åˆ¶å°ä¸Šç¼–è¾‘å‡½æ•°ï¼Œç»™å‡½æ•°è®¾ç½®åç§°ä¸º `APP_ID` å’Œ `SECRET` çš„ç¯å¢ƒå˜é‡ã€‚åœ¨æœ¬åœ°å¼€å‘æ—¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°ç¯å¢ƒè®¾ç½®è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡ã€‚
### å‡†å¤‡

1. ä¸‹è½½å®‰è£… Serverless Devsï¼š`npm install @serverless-devs/s` 
    > è¯¦ç»†æ–‡æ¡£å¯ä»¥å‚è€ƒ [Serverless Devs å®‰è£…æ–‡æ¡£](https://github.com/Serverless-Devs/Serverless-Devs/blob/main/docs/zh/install.md)
2. é…ç½®å¯†é’¥ä¿¡æ¯ï¼š`s config add`
    > è¯¦ç»†æ–‡æ¡£å¯ä»¥å‚è€ƒ [é˜¿é‡Œäº‘å¯†é’¥é…ç½®æ–‡æ¡£](https://github.com/devsapp/fc/blob/main/docs/zh/config.md)
3. å®‰è£… Docker
4. å®‰è£… Nodeï¼ŒNpm ç­‰
### æ›¿æ¢ `s.yaml` ä¸­çš„å˜é‡

ä¿®æ”¹`s.yaml`ä¸­çš„ `"{{ access }}"` `"{{ region }}"` `"{{ serviceName }}"` ä¸ºæ‚¨è‡ªå·±å‡½æ•°çš„å¯†é’¥ï¼Œåœ°åŸŸå’ŒæœåŠ¡åã€‚
### æœ¬åœ°å¼€å‘

1. `npm install`
2. `npm run dev`

å¯åŠ¨æœ¬åœ°å¼€å‘ç¯å¢ƒã€‚ç„¶åæ‚¨å¯ä»¥é€šè¿‡ http://localhost:9000/api/tasks è¿›è¡Œè®¿é—®ã€‚
æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡ http://localhost:9000/documentation æŸ¥çœ‹åŸºäº swagger è‡ªåŠ¨ç”Ÿæˆçš„ API æ–‡æ¡£ã€‚

æ³¨æ„ï¼šæ­¤ Demo ä½¿ç”¨çš„æ˜¯æœ¬åœ°æ•°æ®åº“ï¼ŒæŒ‚è½½åˆ° Nas åšæŒä¹…åŒ–ï¼Œä¸èƒ½ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ æ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„äº‘æ•°æ®ï¼Œç„¶åä¿®æ”¹ `common/base-repository` ä¸­çš„ä»£ç ã€‚[æŸ¥çœ‹ç›¸å…³æ–‡æ¡£å’Œæ¡ˆä¾‹](https://help.aliyun.com/document_detail/84514.html)

### é€šè¿‡äº‘ä¸Šåº”ç”¨ä¸­å¿ƒéƒ¨ç½²

æ‚¨å¯ä»¥ç›´æ¥ä¿®æ”¹ä»£ç ï¼Œæ¨é€åˆ°ä»£ç ä»“åº“æˆ–å‘å¸ƒ Release åï¼Œå°†è‡ªåŠ¨è§¦å‘ CICD æµç¨‹ï¼Œä»è€Œå‘å¸ƒæ‚¨çš„æœ€æ–°æ”¹åŠ¨ã€‚
å¦‚æœæ‚¨ä¸å¸Œæœ›æŠŠ node_modules ç›´æ¥æ‰“åˆ°ä»£ç åŒ…é‡Œï¼Œè€Œæ˜¯ä½¿ç”¨[å±‚](https://help.aliyun.com/document_detail/193057.html)æ¥ç»´æŠ¤ node_modulesï¼Œè¯·æŒ‰ç…§ `s.yaml` ä¸­çš„è¯´æ˜è¿›è¡Œä¿®æ”¹ã€‚å…³äºå±‚çš„åˆ›å»ºè¯·å‚è€ƒâ€œåˆ›å»ºå¹¶å‘å¸ƒå±‚â€ã€‚
### é€šè¿‡æœ¬åœ°ç¯å¢ƒéƒ¨ç½²

`npm run deploy:all` 

ç¼–è¯‘ï¼Œå¹¶å°†æœ€æ–°æ”¹åŠ¨éƒ¨ç½²åˆ°çº¿ä¸Šå‡½æ•°ã€‚
### é€šè¿‡æœ¬åœ°ç¯å¢ƒéƒ¨ç½²ï¼ˆä¸åŒ…æ‹¬ node_modulesï¼‰

`npm run deploy:code` 

ç¼–è¯‘ï¼Œå¹¶å°†æœ€æ–°æ”¹åŠ¨éƒ¨ç½²åˆ°çº¿ä¸Šå‡½æ•°ã€‚ä½†æ˜¯éƒ¨ç½²çš„ä»£ç åŒ…ä¸­ï¼Œä¸åŒ…å« node_modulesã€‚node_modules éœ€è¦é€šè¿‡[å±‚](https://help.aliyun.com/document_detail/193057.html)è¿›è¡Œéƒ¨ç½²ã€‚è¿™æ ·å¯ä»¥è¾ƒå°‘ CICD çš„æ—¶é—´å’Œå†·å¯åŠ¨æ—¶é—´ã€‚å…·ä½“æ–¹å¼è¯·å‚è€ƒâ€œåˆ›å»ºå¹¶å‘å¸ƒå±‚â€ã€‚

### åˆ›å»ºå¹¶å‘å¸ƒå±‚

`npm run create:layer` 

æ ¹æ®æœ€æ–°çš„ package.json æ„å»ºæ‰€éœ€çš„ node_modulesï¼Œå¹¶åˆ›å»º[å±‚](https://help.aliyun.com/document_detail/193057.html)ã€‚
åˆ›å»ºæˆåŠŸåï¼Œæ‚¨éœ€è¦åœ¨æ§åˆ¶å°ä¸­é…ç½®å‡½æ•°ä½¿ç”¨è¿™ä¸ªå±‚ã€‚

æ³¨æ„ï¼šæ¯æ¬¡éœ€è¦ä¿®æ”¹ä¾èµ–æ—¶ï¼Œæ‚¨éœ€è¦ä½¿ç”¨æ­¤å‘½ä»¤æ„å»ºæ–°çš„å±‚ï¼Œå¹¶æ›´æ–°å‡½æ•°çš„é…ç½®ï¼Œä½¿ç”¨æ–°çš„å±‚ã€‚

> - Serverless Devs é¡¹ç›®ï¼šhttps://www.github.com/serverless-devs/serverless-devs   
> - Serverless Devs æ–‡æ¡£ï¼šhttps://www.github.com/serverless-devs/docs   
> - Serverless Devs é’‰é’‰äº¤æµç¾¤ï¼š33947367    
> - åç«¯ä»£ç æ¥è‡ªï¼š[typescript-hapi-starter]https://github.com/BlackBoxVision/typescript-hapi-starter